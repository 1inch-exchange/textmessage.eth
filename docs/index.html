<!doctype html>
<html>
  <head>
    <title>TextMessage.eth - Send SMS messages via Ethereum Blockchain</title>

<style>

@import url(https://fonts.googleapis.com/css?family=Lato:400,700);
@import url(https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700);

body{
  background: #ddd;
  font-family: 'PT Sans Narrow';
}

h1 {
  text-transform: uppercase;
  font-size: 30px;
  letter-spacing: 1px;
  margin: 0;
  padding: 0;
}

p{
  margin: 0 0 15px 0;
  padding: 0;
  color: #555;
  font-style: italic;
  font-size: 14px;
}

.formholder{
  width: 428px;
  margin: 50px auto;
  padding: 50px;
}

input {
  font-family: 'PT Sans Narrow';
  font-size: 20px;
}

.info{
  display: inline-block;
  margin-right: 5px;
}

.info input {
  display: block;
  width: 300px;
  height: 20px;
  border: 0;
  border-radius: 3px;
  margin: 0 0 10px 0;
  padding: 12px 10px;
  background: #fff;
}

.info input:last-child {
  margin: 0;
}

.info input:focus {
  background: #eee;
  outline: none;
}

input[type="submit"]{
  vertical-align: top;
  height: 98px;
  width: 98px;
  margin: 0;
  padding: 0;
  border: 0;
  border-radius: 3px;
  background: pink;
  cursor: pointer;
  font-weight: 700;
  letter-spacing: 1px;
  color: #fff;
  background: linear-gradient(45deg, #FF6C54, #FFA754);
}

input[type="submit"]:hover{
  background: linear-gradient(180deg, #FF6C54, #FFA754);
}

.tip-button {
  width: 304px;
  height: 50px;
  background-size: 100%;
  background-image: url('images/3_pay_mm_over.png');
  cursor: pointer;
}

.tip-button:hover {
  background-image: url('images/3_pay_mm_over.png');
}

.tip-button:active {
  background-image: url('images/3_pay_mm_over.png');
}

</style>


  </head>

  <body>
  
  
<div class="formholder">
  <h1>TextMessage.eth</h1>
  <p>Send SMS Text Messages via Ethereum Blockchain</p>
  <div class="info">
    <input type="text" id="number" placeholder="Cellphone Number">
    <input type="text" id="bodymsg" placeholder="Message">
	<div class="costwei"></div>
	<div class="message"></div>
	<a href="https://github.com/hunterlong/textmessage.eth">View on Github</a>
  </div>
  <input class="paybutton" type="submit" value="txt">
</div>

  </body>

<script>

var MY_ADDRESS = '0x9b6BAA7DE8751328E8e0a8b872Ff8d36539b313D'

var tipButton = document.querySelector('.paybutton')

var costWei = 0;

const abi = [{"constant":false,"inputs":[{"name":"newUrl","type":"string"}],"name":"changeApiUrl","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"enabled","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"phoneNumber","type":"string"},{"name":"textBody","type":"string"}],"name":"sendText","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[],"name":"enableContract","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"pauseContract","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"costWei","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"price","type":"uint256"}],"name":"changeCost","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newCost","type":"uint256"}],"name":"updateCost","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newStatus","type":"string"}],"name":"updateEnabled","type":"event"}];
var deployedContract;



window.addEventListener("load", function(){

  if (typeof web3 === 'undefined') {
    return renderMessage('<div>You need to install <a href=“https://metmask.io“>MetaMask </a> to use this feature.  <a href=“https://metmask.io“>https://metamask.io</a></div>')
  }
  
   deployedContract = web3.eth.contract(abi).at(MY_ADDRESS);
   
     deployedContract.costWei(function(error, result){
     if(!error) {
         costWei = result;
		 renderCost(costWei);

     } else {
         console.error(error);
	 }
 });

});
  
tipButton.addEventListener('click', function() {

  if (typeof web3 === 'undefined') {
    return renderMessage('<div>You need to install <a href=“https://metmask.io“>MetaMask </a> to use this feature.  <a href=“https://metmask.io“>https://metamask.io</a></div>')
  }

  var user_address = web3.eth.accounts[0]
  deployedContract = web3.eth.contract(abi).at(MY_ADDRESS);

   runAction();

})


function runAction() {

var num = document.getElementById('number').value;

var body = document.getElementById('bodymsg').value;

   deployedContract.sendText(num, body, {value: costWei, gas: 200000}, function(error, result){
		 if(!error)
			 console.log(result)
		 else
			 console.error(error);
   });

}

function renderMessage (message) {
  var messageEl = document.querySelector('.message')
  messageEl.innerHTML = message
}

function renderCost (message) {
  var messageEl = document.querySelector('.costwei')
  messageEl.innerHTML = message
}

</script>

</html>