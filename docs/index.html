<!doctype html>
<html>
  <head>
    <title>MetaMask Tip Button Example</title>

<style>

.tip-button {
  width: 304px;
  height: 50px;
  background-size: 100%;
  background-image: url('images/3_pay_mm_over.png');
  cursor: pointer;
}

.tip-button:hover {
  background-image: url('images/3_pay_mm_over.png');
}

.tip-button:active {
  background-image: url('images/3_pay_mm_over.png');
}

</style>


  </head>

  <body>
    <h1>TextMessage.ETH</h1>
	
	Phone Number: <input type="text" name="number"><br>
	Message Body: <input type="text" name="msg"><br>
	<div class="costwei">Current Cost: 0 wei</div>
	
    <a href="https://github.com/hunterlong/textmessage.eth">View on Github</a>
    <div class="tip-button"></div>
    <div class="message"></div>
  </body>

<script>

var MY_ADDRESS = '0x9b6BAA7DE8751328E8e0a8b872Ff8d36539b313D'

var tipButton = document.querySelector('.tip-button')

var costWei = 0;

const abi = [{"constant":false,"inputs":[{"name":"newUrl","type":"string"}],"name":"changeApiUrl","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"enabled","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"phoneNumber","type":"string"},{"name":"textBody","type":"string"}],"name":"sendText","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[],"name":"enableContract","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"pauseContract","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"costWei","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"price","type":"uint256"}],"name":"changeCost","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newCost","type":"uint256"}],"name":"updateCost","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newStatus","type":"string"}],"name":"updateEnabled","type":"event"}];

tipButton.addEventListener('click', function() {

  if (typeof web3 === 'undefined') {
    return renderMessage('<div>You need to install <a href=“https://metmask.io“>MetaMask </a> to use this feature.  <a href=“https://metmask.io“>https://metamask.io</a></div>')
  }

  var user_address = web3.eth.accounts[0]
  
  const deployedContract = web3.eth.contract(abi).at(MY_ADDRESS);
  
  deployedContract.costWei(function(error, result){
     if(!error) {
         costWei = result;
		 renderCost(costWei);
		 
		   //deployedContract.sendText('18054163434', "yoyoyoyo", {value: 200, gas: 2000});

     } else {
         console.error(error);
	 }
 });
 
 
  web3.eth.sendTransaction({
    to: MY_ADDRESS,
    from: user_address,
    value: costWei,
  }, function (err, transactionHash) {
    if (err) return renderMessage('There was a problem!: ' + err.message)

    // If you get a transactionHash, you can assume it was sent,
    // or if you want to guarantee it was received, you can poll
    // for that transaction to be mined first.
    renderMessage('Thanks for the generosity!!')
  })
})

function renderMessage (message) {
  var messageEl = document.querySelector('.message')
  messageEl.innerHTML = message
}

function renderCost (message) {
  var messageEl = document.querySelector('.costwei')
  messageEl.innerHTML = message
}

</script>

</html>